# The compose file is only for building images

version: '3.8'

services:
  l1_chain:
    image: metisdao/hardhat:latest
    build:
      context: ../ops/docker/hardhat
      dockerfile: Dockerfile
      x-bake:
        platforms:
          - 'linux/amd64'
          - 'linux/arm64'
        output: type=docker

  deployer:
    image: metisdao/deployer:${METIS_DEPLOYER_VERSION:-latest}
    build:
      context: ..
      target: deployer
      dockerfile: ./ops/docker/Dockerfile
      x-bake:
        platforms:
          - 'linux/amd64'
          - 'linux/arm64'
        output: type=docker

  dtl:
    image: metisdao/data-transport-layer:${METIS_DTL_VERSION:-latest}
    build:
      context: ..
      dockerfile: ./ops/docker/Dockerfile
      target: data-transport-layer
      x-bake:
        platforms:
          - 'linux/amd64'
          - 'linux/arm64'
        output: type=docker

  relayer:
    image: metisdao/message-relayer:${METIS_RELAYER_VERSION:-latest}
    build:
      context: ..
      dockerfile: ./ops/docker/Dockerfile
      target: message-relayer
      x-bake:
        platforms:
          - 'linux/amd64'
          - 'linux/arm64'
        output: type=docker

  batch_submitter:
    image: metisdao/batch-submitter:${METIS_SUBMITTER_VERSION:-latest}
    build:
      context: ..
      dockerfile: ./ops/docker/Dockerfile
      target: batch-submitter
      x-bake:
        platforms:
          - 'linux/amd64'
          - 'linux/arm64'
        output: type=docker

  l2geth:
    image: metisdao/l2geth:${METIS_L2GETH_VERSION:-latest}
    build:
      context: ..
      dockerfile: ./ops/docker/Dockerfile.geth
      x-bake:
        platforms:
          - 'linux/amd64'
          - 'linux/arm64'
        output: type=docker

  gas-oracle:
    image: metisdao/gas-oracle:${METIS_GAS_ORACLE_VERSION:-latest}
    build:
      context: ..
      dockerfile: ./ops/docker/Dockerfile.gas-oracle
      x-bake:
        platforms:
          - 'linux/amd64'
          - 'linux/arm64'
        output: type=docker
